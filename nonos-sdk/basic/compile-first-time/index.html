<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:image" content="../../../img/logo.png"/>

  
  <meta name="author" content="Tuan PM">
  
  <title>Biên dịch dự án mẫu - Internet Of Things (IoT) với ESP8266</title>
  

  <link rel="shortcut icon" href="../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">

  <link rel="stylesheet" href="../../../css/custom.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Biên dịch dự án mẫu";
    var mkdocs_page_input_path = "nonos-sdk/basic/compile-first-time.md";
    var mkdocs_page_url = "/nonos-sdk/basic/compile-first-time/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script>
  <script src="../../../js/jquery.cookie-1.4.1.min.js"></script>
  <script src="../../../js/nav.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60470603-4', 'esp8266.vn');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Internet Of Things (IoT) với ESP8266</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../.." id="Trang chủ" style="font-size:95%;font-weight:bold;">Trang chủ</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="current">
        <a class="current"  id="Nội dung" style="font-size:95%;font-weight:bold;">Nội dung</a>
    </li>
    
        <li class="">
            <a style="padding-left:50px;" class=""  id="Kiến thức cơ bản" onclick="showChildren('Kiến thức cơ bản')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i> Kiến thức cơ bản</a>
        </li>
        
        <div style="display:none" id="hidden_Kiến thức cơ bản">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/introduction/" id="Tổng quan">  Tổng quan </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnTổng quan">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/about-iot/" id="Internet Of Things (IoT)">  Internet Of Things (IoT) </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnInternet Of Things (IoT)">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/about-esp8266/" id="ESP8266 & ESP8285">  ESP8266 & ESP8285 </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnESP8266 & ESP8285">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/esp-module/" id="Các loại Module">  Các loại Module </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnCác loại Module">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/board/" id="Board phát triển">  Board phát triển </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnBoard phát triển">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../introduction/prepare/" id="Phần cứng & công cụ">  Phần cứng & công cụ </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_Kiến thức cơ bảnPhần cứng & công cụ">
            
            </div>
        
        </div>
    
        <li class="current">
            <a style="padding-left:50px;" class="current"  id="ESP8266 NONOS-SDK" onclick="showChildren('ESP8266 NONOS-SDK')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i> ESP8266 NONOS-SDK</a>
        </li>
        
        <div style="display:none" id="hidden_ESP8266 NONOS-SDK">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../nonos-sdk/" id="Giới thiệu">  Giới thiệu </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKGiới thiệu">
            
            </div>
        
            <li class="current">
                <a style="padding-left:70px;" class="current"  id="Cơ bản" onclick="showChildren('ESP8266 NONOS-SDKCơ bản')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Cơ bản </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKCơ bản">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../basic/" id="Cài đặt công cụ cần thiết">Cài đặt công cụ cần thiết </a>
                </li>
            
                <li class="current">
                    <a style="padding-left:90px;" class="current" href="./" id="Biên dịch dự án mẫu">Biên dịch dự án mẫu </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../blink-led/" id="Bật tắt LED">Bật tắt LED </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../button/" id="Nút nhấn">Nút nhấn </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../uart/" id="UART">UART </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../complex-makefile/" id="Makefile cho dự án phức tạp">Makefile cho dự án phức tạp </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../task/" id="Task">Task </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../wifi/" id="Wifi">Wifi </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../espconn/" id="ESPCONN">ESPCONN </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../mdns/" id="MDNS">MDNS </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../ntp/" id="NTP">NTP </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../save-to-flash/" id="Lưu dữ liệu vào Flash">Lưu dữ liệu vào Flash </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Smartconfig" onclick="showChildren('ESP8266 NONOS-SDKSmartconfig')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Smartconfig </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKSmartconfig">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../smartconfig/smartconfig/" id="ESP8266 Smartconfig">ESP8266 Smartconfig </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../smartconfig/why-smartconfig/" id="Tại sao cần Smartconfig">Tại sao cần Smartconfig </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../smartconfig/esptouch/" id="ESPTOUCH & AIRKISS">ESPTOUCH & AIRKISS </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../smartconfig/wps/" id="WPS">WPS </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="MQTT" onclick="showChildren('ESP8266 NONOS-SDKMQTT')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  MQTT </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKMQTT">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../mqtt/what-is-mqtt/" id="Giao thức MQTT">Giao thức MQTT </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../mqtt/mqtt-client/" id="ESP8266 MQTT Client">ESP8266 MQTT Client </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="HTTP Client" onclick="showChildren('ESP8266 NONOS-SDKHTTP Client')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  HTTP Client </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKHTTP Client">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../http-client/http-client/" id="ESP8266 HTTP Client">ESP8266 HTTP Client </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="HTTP Server" onclick="showChildren('ESP8266 NONOS-SDKHTTP Server')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  HTTP Server </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKHTTP Server">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../http-server/http-server/" id="ESP8266 HTTP Server">ESP8266 HTTP Server </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Firmware Over The Air" onclick="showChildren('ESP8266 NONOS-SDKFirmware Over The Air')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Firmware Over The Air </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKFirmware Over The Air">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../fota/fota/" id="FOTA">FOTA </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="ESP Now" onclick="showChildren('ESP8266 NONOS-SDKESP Now')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  ESP Now </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKESP Now">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../esp-now/esp-now/" id="ESP Now">ESP Now </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="ESP Mesh" onclick="showChildren('ESP8266 NONOS-SDKESP Mesh')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  ESP Mesh </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKESP Mesh">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../esp-mesh/esp-mesh/" id="ESP Mesh">ESP Mesh </a>
                </li>
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Các dự án" onclick="showChildren('ESP8266 NONOS-SDKCác dự án')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Các dự án </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 NONOS-SDKCác dự án">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../projects/list/" id="Danh sách">Danh sách </a>
                </li>
            
            </div>
        
        </div>
    
        <li class="">
            <a style="padding-left:50px;" class=""  id="ESP8266 FreeRTOS-SDK" onclick="showChildren('ESP8266 FreeRTOS-SDK')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i> ESP8266 FreeRTOS-SDK</a>
        </li>
        
        <div style="display:none" id="hidden_ESP8266 FreeRTOS-SDK">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../freertos-sdk/freertos-sdk/" id="Giới thiệu">  Giới thiệu </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 FreeRTOS-SDKGiới thiệu">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Cơ bản" onclick="showChildren('ESP8266 FreeRTOS-SDKCơ bản')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Cơ bản </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 FreeRTOS-SDKCơ bản">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../freertos-sdk/basic/introduction/" id="Cài đặt công cụ cần thiết">Cài đặt công cụ cần thiết </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../freertos-sdk/basic/basic-task/" id="Task cơ bản">Task cơ bản </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../freertos-sdk/basic/software-timer/" id="Software Timer">Software Timer </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../freertos-sdk/basic/queue-semaphore-mutex/" id="Đồng bộ / trao đổi dữ liệu">Đồng bộ / trao đổi dữ liệu </a>
                </li>
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../freertos-sdk/basic/task-notification/" id="Task notification">Task notification </a>
                </li>
            
            </div>
        
        </div>
    
        <li class="">
            <a style="padding-left:50px;" class=""  id="ESP8266 Arduino" onclick="showChildren('ESP8266 Arduino')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i> ESP8266 Arduino</a>
        </li>
        
        <div style="display:none" id="hidden_ESP8266 Arduino">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../arduino/arduino/" id="Giới thiệu">  Giới thiệu </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 ArduinoGiới thiệu">
            
            </div>
        
        </div>
    
        <li class="">
            <a style="padding-left:50px;" class=""  id="ESP8266 Micropython" onclick="showChildren('ESP8266 Micropython')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i> ESP8266 Micropython</a>
        </li>
        
        <div style="display:none" id="hidden_ESP8266 Micropython">
        
            <li class="">
                <a style="padding-left:70px;" class="" href="../../../micropython/micropython/" id="Giới thiệu">  Giới thiệu </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 MicropythonGiới thiệu">
            
            </div>
        
            <li class="">
                <a style="padding-left:70px;" class=""  id="Cơ bản" onclick="showChildren('ESP8266 MicropythonCơ bản')"> <i class="fa fa-plus-square" style="padding-left:5px;font-size:13px;"></i>  Cơ bản </a>
                <!--  -->
            </li>
            
            <div style="display:none" id="hidden_ESP8266 MicropythonCơ bản">
            
                <li class="">
                    <a style="padding-left:90px;" class="" href="../../../micropython/basic/introduction/" id="Cài đặt công cụ cần thiết">Cài đặt công cụ cần thiết </a>
                </li>
            
            </div>
        
        </div>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../projects/list/" id="Các dự án" style="font-size:95%;font-weight:bold;">Các dự án</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../license/" id="Bản quyền" style="font-size:95%;font-weight:bold;">Bản quyền</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
            <li><ul class="subnav">
    <li class="">
        <a class="" href="../../../contributor/" id="Đóng góp" style="font-size:95%;font-weight:bold;">Đóng góp</a>
    </li>
    
    <li class="paddingtop20"></li>
</ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Internet Of Things (IoT) với ESP8266</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
    <ul class="wy-breadcrumbs">
        <li><a href="../../..">Docs</a> &raquo;</li>
          
        <li>ESP8266 NONOS-SDK &raquo;</li>
          
        <li>Cơ bản &raquo;</li>
           
        <li>Biên dịch dự án mẫu</li>
        <li class="wy-breadcrumbs-aside">
             
                
            <a href="https://github.com/esp8266vn/esp8266.vn/tree/master/docs/nonos-sdk/basic/compile-first-time.md" class="icon icon-github"> Edit on GitHub</a>
                
             
        </li>
    </ul>
    <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc">
<ul>
<li><a href="#bien-dich-du-an-au-tien">Biên dịch dự án đầu tiên</a><ul>
<li><a href="#lay-du-an-mau-tu-github">Lấy dự án mẫu từ Github:</a></li>
<li><a href="#so-o-file">Sơ đồ file</a><ul>
<li><a href="#makefile">Makefile</a></li>
<li><a href="#rf_initc">rf_init.c</a></li>
<li><a href="#mainc">main.c</a></li>
</ul>
</li>
<li><a href="#bien-dich">Biên dịch</a></li>
<li><a href="#ket-qua">Kết quả</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="bien-dich-du-an-au-tien">Biên dịch dự án đầu tiên<a class="headerlink" href="#bien-dich-du-an-au-tien" title="Permanent link">#</a></h1>
<p>Trước khi biên dịch dự án mẫu, bạn cần phải cài đặt đầy đủ <strong>Trình biên dịch</strong>, tải về <strong>esptool.py</strong> và <strong>ESP8266-NONOS-SDK</strong> như hướng dẫn Cài đặt</p>
<p>Trong phần này sẽ trình bày rất chi tiết để biên dịch một dự án hoàn chỉnh, bao gồm một số kiến thức bổ trợ liên quan tới lập trình <strong>C</strong> và được giải thích rõ ràng, cẩn thận. Bạn có thể bỏ qua phần này nếu đã hiểu rõ về <strong>lập trình C</strong></p>
<div class="admonition note">
<p class="admonition-title">Nội dung</p>
<p>Hiển thị <code>helloworld</code> trên terminal</p>
</div>
<h2 id="lay-du-an-mau-tu-github">Lấy dự án mẫu từ Github:<a class="headerlink" href="#lay-du-an-mau-tu-github" title="Permanent link">#</a></h2>
<p>Bạn có thể lấy dự án mẫu từ github và biên dịch ngay:</p>
<pre><code class="bash">git clone https://github.com/esp8266vn/esp-iot-basic.git
cd esp-iot-basic &amp;&amp; make
</code></pre>

<h2 id="so-o-file">Sơ đồ file<a class="headerlink" href="#so-o-file" title="Permanent link">#</a></h2>
<pre><code>esp-iot-basic
    |-- Makefile
    |-- main.c
    |-- rf_init.c
    `-- user_config.h
</code></pre>

<ul>
<li><code>Makefile</code> Giúp cho công cụ <code>make</code> thực hiện việc biên dịch dự án một cách tự động</li>
<li><code>main.c</code> Chứa mã nguồn thực thi chính của chương trình</li>
<li><code>rf_init.c</code> Khi khởi động, {esp} sẽ thực hiện một số lệnh cấu hình RF (thu phát không dây), SDK sẽ gọi các hàm này. Bạn bắt buộc phải cung cấp giá trị trả về cho nó.</li>
<li><code>user_config.h</code> Khi biên dịch, SDK sẽ <code>include</code> file này, bạn có thể để file trống không nội dung.</li>
</ul>
<h3 id="makefile">Makefile<a class="headerlink" href="#makefile" title="Permanent link">#</a></h3>
<pre><code class="Makefile">#esp-iot-basic/Makefile
XTENSA    ?= 
SDK_BASE  ?= /tools/esp8266/sdk/ESP8266_NONOS_SDK 
ESPTOOL   ?= /tools/esp8266/esptool/esptool.py
SDK_LIBS  := -lc -lgcc -lhal -lphy -lpp -lnet80211 -lwpa -lmain\
            -llwip -lcrypto -ljson 
CC        := $(XTENSA)xtensa-lx106-elf-gcc
LD        := $(XTENSA)xtensa-lx106-elf-gcc
AR        := $(XTENSA)xtensa-lx106-elf-ar
LDFLAGS   = -nostdlib -Wl,--no-check-sections -u call_user_start -Wl,-static
CFLAGS    = -g -Wpointer-arith -Wundef -Wl,-EL -fno-inline-functions -nostdlib\ 
        -mlongcalls -mtext-section-literals -ffunction-sections -fdata-sections\
        -fno-builtin-printf -DICACHE_FLASH\
        -I.\
        -I$(SDK_BASE)/include
LD_SCRIPT = -T$(SDK_BASE)/ld/eagle.app.v6.ld 

all: main.bin

main.bin: main.out
  $(ESPTOOL) elf2image $(ESPTOOL_FLASHDEF) main.out -o main

main.out: main.a
  @echo &quot;LD main.out&quot;
  $(LD) -L$(SDK_BASE)/lib $(LD_SCRIPT) $(LDFLAGS) -L$(SDK_BASE)/lib\
  -Wl,--start-group $(SDK_LIBS) main.a -Wl,--end-group -o main.out 

main.a: main.o
  @echo &quot;AR main.o&quot;
  $(AR) cru main.a main.

main.o:
  @echo &quot;CC main.c &amp; rf_init.c&quot;
  $(CC) $(CFLAGS) -c main.c -o main.o &lt;14&gt;
  $(CC) $(CFLAGS) -c rf_init.c -o rf_init.o &lt;14&gt;

clean:
  rm -rf *.o *.bin *.a *.out 

flash:
  $(ESPTOOL) --port /dev/tty.SLAB_USBtoUART \
                   --baud 480600 \
                   write_flash --flash_freq 40m --flash_mode dio --flash_size 32m \
                   0x00000 main0x00000.bin \
                   0x10000 main0x10000.bin \
                   0x3fc000 $(SDK_BASE)/bin/esp_init_data_default.bin
.PHONY: all clean flash
</code></pre>

<div class="admonition note">
<p class="admonition-title">Lưu ý</p>
<p>Nếu bạn sử dụng ví dụ này cho bản Unofficial Developement KIT trên Windows, với đường dẫn cài đặt mặc định là <code>C:\Espressif</code>, Makefile cần thay đổi như sau:</p>
</div>
<pre><code class="makefile">XTENSA    ?=
SDK_BASE  ?= C:/Espressif/ESP8266_SDK
ESPTOOL   ?= C:/Espressif/utils/ESP8266/esptool.py
...
# Ví dụ cổng serial dùng để nạp cho ESP8266 là COM3:
flash:
   $(ESPTOOL) --port COM3 \
          --baud 480600 \
          write_flash --flash_freq 40m --flash_mode dio --flash_size 32m \
          0x00000 main0x00000.bin \
          0x10000 main0x10000.bin \
          0x3fc000 $(SDK_BASE)/bin/esp_init_data_default.bin
</code></pre>

<p>Giải thích Makefile như sau:</p>
<ul>
<li><code>XTENSA</code> Đường dẫn tới trình biên dịch, để trống nếu bạn đã thêm vào biến môi trường <code>PATH</code> của hệ điều hành, hoặc có dạng <code>/tools/esp8266/compiler/xtensa-lx106-elf/bin/</code></li>
<li><code>SDK_BASE</code> Đường dẫn tới <strong>SDK</strong>, nếu là Windows có dạng <code>C:\Espressif\ESP8266_NONOS_SDK</code></li>
<li><code>ESPTOOL</code> Đường dẫn tới <strong>esptool.py</strong>, nhớ đảm bảo quyền thực thi cho file này (thực hiện lệnh <code>chmod +x</code>)</li>
<li><code>SDK_LIBS</code> Các thư viện đi kèm với <strong>SDK</strong>, ví dụ nếu bạn dùng <code>smartconfig</code> thì thêm vào <code>-lsmartconfig</code></li>
<li><code>CC</code>, <code>AR</code>, <code>LD</code> Định nghĩa ngắn gọn Compiler, Linker, Archiver</li>
<li><code>LDFLAGS</code> là cờ dành cho Linker </li>
<li><code>CFLAGS</code> là cờ dành cho Compiler</li>
<li>Cờ <code>-I.</code> để báo Compiler biết có thể tìm header file (từ khóa <code>#include</code>) trong thư mục hiện tại và SDK include</li>
<li><code>LD_SCRIPT</code> Linker scirpt mặc định của <strong>SDK</strong> cho chip ESP8266</li>
<li>
<p>Mặc định khi gọi <code>make</code> hay <code>make all</code> sẽ gọi <code>all</code>, nhưng trước đó sẽ cần gọi <code>main.bin</code></p>
</li>
<li>
<p>Thực hiện <code>make clean</code> xóa hết các file được tạo ra khi gọi <code>make all</code></p>
</li>
<li>Thực hiện <code>make flash</code> để nạp ESP8266, cần chắc chắc mạch nạp đã được kết nối máy tính, và tên cổng được thay thế đúng cho <code>/dev/tty.SLAB_USBtoUART</code> (thường với linux sẽ là /dev/ttyUSB0, MAC OS là SLAB_USBtoUART). Ngoài ra tốc độ baud cần phải thay thế cho phù hợp(mặc định ban đầu có thể là 9600 hoặc 115200 hoặc 480600) .Bạn có thể tìm hiểu thêm về việc đọc tên công COM trên máy tính tại (OSX, Windows, Linux)</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Quan trọng</p>
<ul>
<li>Dấu <code>\</code> báo chưa kết thúc dòng trong Makefile</li>
<li>Trong <code>Makefile</code>, luôn luôn đặt chế độ Indent là Tab, nếu dùng Space sẽ báo lỗi <code>Makefile:35: *** missing separator.  Stop.</code></li>
</ul>
</div>
<p>Các bạn có thể tìm hiểu rõ hơn về Makefile bằng google với từ khóa <code>Makefile basic</code>. Makefile này như là 1 kịch bản đơn giản nhất để công cụ <code>make</code> thực hiện việc biên dịch mã nguồn <strong>C</strong> sang mã máy để nạp cho ESP8266. Mục đích để bản nắm rõ hơn về cách thức hoạt động của SDK, trình biên dịch. Các ví dụ sau này sẽ dùng Makefile phức tạp hơn, và được cung cấp kèm với các dự án mẫu tại https://github.com/esp8266vn</p>
<h3 id="rf_initc">rf_init.c<a class="headerlink" href="#rf_initc" title="Permanent link">#</a></h3>
<pre><code class="c">//esp-iot-basic/rf_init.c
#include &lt;stdio.h&gt;
#include &quot;osapi.h&quot;
#include &quot;user_interface.h&quot;

void __attribute__((weak)) user_rf_pre_init(void)
{
  system_phy_set_rfoption(1);
  system_phy_set_max_tpw(82);
}

uint32_t __attribute__((weak)) user_rf_cal_sector_set(void)
{
    enum flash_size_map size_map = system_get_flash_size_map();
    uint32 rf_cal_sec = 0;

    switch (size_map) {
        case FLASH_SIZE_4M_MAP_256_256:
            rf_cal_sec = 128 - 5;
            break;

        case FLASH_SIZE_8M_MAP_512_512:
            rf_cal_sec = 256 - 5;
            break;

        case FLASH_SIZE_16M_MAP_512_512:
        case FLASH_SIZE_16M_MAP_1024_1024:
            rf_cal_sec = 512 - 5;
            break;

        case FLASH_SIZE_32M_MAP_512_512:
        case FLASH_SIZE_32M_MAP_1024_1024:
            rf_cal_sec = 1024 - 5;
            break;

        default:
            rf_cal_sec = 0;
            break;
    }
    return rf_cal_sec;
</code></pre>

<h3 id="mainc">main.c<a class="headerlink" href="#mainc" title="Permanent link">#</a></h3>
<pre><code class="c">#include &lt;stdio.h&gt;
#include &quot;osapi.h&quot;
#include &quot;user_interface.h&quot;

void app_init()
{
    uart_div_modify(0, UART_CLK_FREQ / 115200);
    os_delay_us(1000000);
    os_printf(&quot;\r\nhello world\r\n&quot;);
}

void user_init(void)
{
    system_init_done_cb(app_init);
}

</code></pre>

<h2 id="bien-dich">Biên dịch<a class="headerlink" href="#bien-dich" title="Permanent link">#</a></h2>
<p>Thực hiện biên dịch dự án</p>
<pre><code class="bash">cd esp-iot-basic
make clean
make
make flash
</code></pre>

<p>Màn hình Terminal kết thúc như sau là đã hoàn thành việc ghi vào ESP8266:</p>
<pre><code class="bash">esptool.py v1.2-dev
Connecting...
Running Cesanta flasher stub...
Flash params set to 0x0240
Writing 32768 @ 0x0... 32768 (100 %)
Wrote 32768 bytes at 0x0 in 0.8 seconds (334.0 kbit/s)...
Writing 196608 @ 0x10000... 196608 (100 %)
Wrote 196608 bytes at 0x10000 in 4.7 seconds (334.5 kbit/s)...
Writing 4096 @ 0x3fc000... 4096 (100 %)
Wrote 4096 bytes at 0x3fc000 in 0.1 seconds (320.4 kbit/s)...
Leaving...
</code></pre>

<h2 id="ket-qua">Kết quả<a class="headerlink" href="#ket-qua" title="Permanent link">#</a></h2>
<p>Mở cổng COM bằng bất kỳ phần mềm nào hỗ trợ. Windows có thể sử dụng teraterm, putty; MacOS/OSX, Linux thì sử dụng screen, minicom. Sau khi kết nối xong, bấm nút RESET trên board phát triển, bạn sẽ nhận được 1 loạt các ký tự lạ đầu tiên. Đó là các ký tự do các module của SDK sinh ra, nhưng trước khi ứng dụng mẫu cấu hình đúng tốc độ Baud:</p>
<pre><code class="bash">...
hello world
scandone
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../blink-led/" class="btn btn-neutral float-right" title="Bật tắt LED">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../basic/" class="btn btn-neutral" title="Cài đặt công cụ cần thiết"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 <a href="https://esp8266.vn">ESP8266 Viet Nam</a> - Tài trợ bởi <a href="https://iotmaker.vn">IoT Maker Viet Nam</a></p>
    
  </div>

  
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<!-- <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/esp8266vn/esp8266.vn" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../basic/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../blink-led/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div> -->

<script type="text/javascript">
  // If cookie is defined toggle the id
  if (typeof $.cookie('docToggle') !== 'undefined') {
      // Parse cookie which is an array
      var _parsed_cookie = JSON.parse($.cookie('docToggle'));
      // Loop over array and show hidden divs
      $.each(_parsed_cookie, function(index, value) {
          // Toggle
          $("[id='hidden_" + value + "']").css('display','');
      })
  }
</script>

</body>
</html>